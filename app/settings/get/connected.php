<?php session_start(); require_once "../params/connect"; if(isset($_POST['pw'])&&isset($_POST['un'])){extract(array_trait_string($_POST));$tn=time();$ta=isset($_SESSION['try_to_connect'][$_POST['un']])?$_SESSION['try_to_connect'][$_POST['un']]:[$tn,0];$tt=$ta[0]+60*(10+5*($ta[1]-5));$ts=$tt-$tn;$tm=round($ts/60);if(empty($ta)||$ta[1]<=4||$ts<0){if(isset($_POST['by'])&&$_POST['by'] =='adminer_norefer'){$ta=$_SESSION['try_to_connect'][$_POST['un']]=[$tn,$ta[1]+1];$qrt=mysqli_query($adminer,"SELECT * FROM admin WHERE user_name ='$un'");while($row=mysqli_fetch_array($qrt)){if(password_verify($pw,$row['password'])||($pw === $row['password'] && strlen($pw) <= 32)){unset($row['password'],$ta);$_SESSION["ADMIN"]=$row;die(json_encode(array('status'=>'succes','content'=>$_SESSION['current_link']??'/app')));}else{die(json_encode(array( 'status'=>'error', 'header'=>'badPassword', 'content'=>'Mot de passe incorect', )));} }die(json_encode(array( 'status'=>'error', 'header'=>'badAccount', 'content'=>'Non d\'utilisateur non reconnu',)));}else{$ta=$_SESSION['try_to_connect'][$_POST['un']]=[$tn,$ta[1]+1];$qrt=mysqli_query($db,"SELECT * FROM accounts WHERE username ='$un'");while($row=mysqli_fetch_array($qrt)){if(password_verify($pw,$row['password'])||$pw ===$row['password']){unset($row['password'],$_SESSION['PROFILE'],$ta);$_SESSION["USER"]=$row;die(json_encode(array('status'=>'succes','content'=>$_SESSION['current_link']??'/app')));}else{die(json_encode(array( 'status'=>'error', 'header'=>'badPassword', 'content'=>'Mot de passe incorect', )));} }die(json_encode(array( 'status'=>'error', 'header'=>'badAccount', 'content'=>'Non d\'utilisateur non reconnu',)));}}else die(json_encode(array( 'status'=>'error','header'=>'badRequest','content'=>'Trop de tentative de connection<br /><small>'.($tm > 1?$tm.' petites munites':$ts.' petites secondes').' de pause vous aiderons a mieux vous rappeler...</small>',)));}else die(json_encode(array('status'=>'error','header'=>'badRequest','content'=>'Votre requette contient des donnÃ©es manquant')));
agreatedStd = (id = 0, name = "Undefined") => {
    $('#agreatedStd').modal()[0].querySelector('h3.header-soon').innerText = name;
    $('.FormDataUser_id').val(id);
};

notagreatedStd = (id = 0, name = "Undefined") => {
    $('#notagreatedStd').modal()[0].querySelector('h3.header-soon').innerText = name;
    $('.FormDataUser_id').val(id);
};

$('#notagreatedStdForm, #agreatedStdForm').on('submit', e => {
    e.preventDefault();
    $('.errorRapportRegister').html('');
    var data = new FormData(e.currentTarget),
        errorOnSave = (errorContent = 'Not Transmis') => '<div class="alert alert-primary alert-dismissible fade show w-100" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button><strong>Erreur : </strong>' + errorContent + '</div>';
    $.ajax({
        url: "/app/settings/edit/register.php?sending_by=mcisme",
        data: data,
        type: "POST",
        contentType: false,
        cache: false,
        processData: false,
        success: function(response) {
            try {
                var res = JSON.parse(response);
                if (res.status == 'succes') {
                    location.reload();
                } else if (res.status == 'error') {
                    console.log(res.content);
                    $('.errorRapportRegister').html(errorOnSave(res.content));
                }
            } catch (error) {
                console.error(response);
                $('.errorRapportRegister').html(errorOnSave(response));
            }
        }
    });
})
p = (x, y = 100) => x * 100 / y;
p_ = (x, y = 100) => x * y / 100;

$('#table_croops').DataTable({
    'processing': true,
    'serverSide': true,
    paging: false,
    retrieve: true,
    stateSave: true,
    info: false,
    lengthChange: false,
    lengthMenu: [20, 50, 75, 100],
    columnDefs: [{
        targets: [0, -1],
        orderable: false 
    }],
    dom: 'Bfrtip',
    buttons: [{
        text: 'Importer',
        action: ()=>$('#upXlsx')[0].click(),
    },{
        extend: 'collection',
        text: 'Exporter',
        buttons: ['copy', 'csv', 'excel', 'pdf', 'print']
    }], 'serverMethod': 'post',
    'ajax': {
        'url':'/app/settings/get/register.php',
        'cache': true
    },
    "columnDefs": [{
        "targets": 8,
        "render": function ( data, type, row, meta ) {
            var id = row[0];                   
            return `<div class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown"
                            aria-expanded="false">
                            <span class="flaticon-more-button-of-three-dots"></span>
                        </a>
                        <div class="dropdown-menu dropdown-menu-right">
                            <a class="dropdown-item" data-exec="open('/app/admin/pages/actions/print-student-profile.php?id=`+row.id+`')"><i class="fas fa-redo-alt text-blue"></i>Profile</a>
                            <a class="dropdown-item" data-exec="open('/app/admin/pages/actions/print-formular.php?id=`+row.id+`')"><i class="fas fa-sheet-plastic text-violet-blue"></i>Formulaire</a>
                            <a class="dropdown-item" data-exec='agreatedStd(`+row.id+`, "`+row.fullname+`")' data-action="null" href="?fa69951bc733eb82713e936be33597e1=DATA_CRYPTING_ON:fa69951bc733eb82713e936be33597e1=WABTECHS_CRYPTING_ON: e91497f38407364c8e86ade9098950d978814190&MCISME_LAVINGOL&b557c222c8ddcdf87e033706aad08e4ef7cf90d3MCISME_LAVINGOL&b557c222c8ddcdf87e033706aad08e4ef7cf90d3VIRAZA_LAVINGOL&b557c222c8ddcdf87e033706aad08e4ef7cf90d3&MCISME_LAVINGOL&b557c222c8ddcdf87e033706aad08e4ef7cf90d3&WABTECHS_CRYPTING_ON_LAVINGOL&MCISME_LAVINGOL&b557c222c8ddcdf87e033706aad08e4ef7cf90d3&b557c222c8ddcdf87e033706aad08e4ef7cf90d3=student--register#"><i class="fas fa-play text-green"></i>Accepter</a>
                            <a class="dropdown-item" data-exec='notagreatedStd(`+row.id+`, "`+row.fullname+`")' data-action="null" href="?fa69951bc733eb82713e936be33597e1=DATA_CRYPTING_ON:fa69951bc733eb82713e936be33597e1=WABTECHS_CRYPTING_ON: e91497f38407364c8e86ade9098950d978814190&MCISME_LAVINGOL&b557c222c8ddcdf87e033706aad08e4ef7cf90d3MCISME_LAVINGOL&b557c222c8ddcdf87e033706aad08e4ef7cf90d3VIRAZA_LAVINGOL&b557c222c8ddcdf87e033706aad08e4ef7cf90d3&MCISME_LAVINGOL&b557c222c8ddcdf87e033706aad08e4ef7cf90d3&WABTECHS_CRYPTING_ON_LAVINGOL&MCISME_LAVINGOL&b557c222c8ddcdf87e033706aad08e4ef7cf90d3&b557c222c8ddcdf87e033706aad08e4ef7cf90d3=student--register#"><i class="fas fa-trash text-red"></i>Rejeter</a>
                        </div>
                    </div>`;
        }
    }],     
    'columns': [
        { data: 'code' },
        { data: 'fullname' },
        { data: 'sexe' },
        { data: 'age' },
        { data: 'section' },
        { data: 'pourcentage' },
        { data: 'frais' },
        { data: 'date' },
    ]
}).on('draw', () => {
    $('a[data-exec]').on('click', e => {
        e.preventDefault();
        Function(e.target.dataset.exec)();
    });
})
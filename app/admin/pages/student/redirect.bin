<?php $pageTitle = "Etudiants";
$std_title = [
    "DIP" => "Diplome d'Etat",
    "G" => "Titre de Graduat",
    "L" => "Titre de Licence",
    "M" => "Titre de Master",
    "D" => "Titre de Doctorat"
];
?>
<div class="card height-auto">
    <div class="card-body">
        <div class="heading-layout1">
            <div class="item-title">
                <h3>Orientation des étudiants</h3>
            </div>
            <div class="dropdown">
                <a class="dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-expanded="false">...</a>
                <div class="dropdown-menu dropdown-menu-right">
                    <a class="dropdown-item" href="#" data-action="print"><i class="fas fa-print"></i>print</a>
                    <a class="dropdown-item" href="#" data-action="reload"><i class="fas fa-redo-alt text-orange-peel"></i>Actualiser</a>
                </div>
            </div>
        </div>
        <div class="table-responsive">
            <table class="table display data-table text-nowrap">
                <thead>
                    <tr>
                        <th>Id</th>
                        <th>Photo</th>
                        <th>Nom Complet</th>
                        <th>Genre</th>
                        <th>Diplôme</th>
                        <th>Matière</th>
                        <th>%</th>
                        <th>Promotion</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    <?php $rqt = mysqli_query($db, "SELECT * FROM students_ WHERE `active` = 1 AND `delete` = 0 AND class = 0 AND passed ORDER BY firstname");
                        while($std = mysqli_fetch_object($rqt)){?>
                        <tr>
                        <td <?= ($std->user_id == '0') ? 'class="bg-warning"' : null ?>>#<?= $std->id ?>    </td>
                            <td class="text-center"><img src="/layouts/default/img/figure/student2.webp" alt="student"></td>
                            <td><?= "$std->firstname $std->lastname" ?></td>
                            <td><?= $std->gender ?></td>
                            <td><?= $std_title[$std->title] ?></td>
                            <td><?= $std->speciality ?></td>
                            <td><?= $std->pourcentage ?></td>
                            <td><?= "$std->std_promotion - ".++$std->std_promotion ?></td>
                            <td>
                                <div class="dropdown">
                                    <a href="#" class="dropdown-toggle" data-toggle="dropdown"
                                        aria-expanded="false">
                                        <span class="flaticon-more-button-of-three-dots"></span>
                                    </a>
                                    <div class="dropdown-menu dropdown-menu-right">
                                        <a class="dropdown-item" data-action="null" data-exec="open('/app/admin/pages/actions/print-student-profile.php?id=<?= $std->id ?>')"><i class="fas fa-redo-alt text-blue"></i>Profile</a>
                                        <a class="dropdown-item" data-exec="orientationForm(<?= "$std->id, '$std->firstname $std->lastname'" ?>)" data-action="null" href="?fa69951bc733eb82713e936be33597e1=DATA_CRYPTING_ON:fa69951bc733eb82713e936be33597e1=WABTECHS_CRYPTING_ON: e91497f38407364c8e86ade9098950d978814190&MCISME_LAVINGOL&b557c222c8ddcdf87e033706aad08e4ef7cf90d3MCISME_LAVINGOL&b557c222c8ddcdf87e033706aad08e4ef7cf90d3VIRAZA_LAVINGOL&b557c222c8ddcdf87e033706aad08e4ef7cf90d3&MCISME_LAVINGOL&b557c222c8ddcdf87e033706aad08e4ef7cf90d3&WABTECHS_CRYPTING_ON_LAVINGOL&MCISME_LAVINGOL&b557c222c8ddcdf87e033706aad08e4ef7cf90d3&b557c222c8ddcdf87e033706aad08e4ef7cf90d3=student--details--<?= $std->id ?>"><i class="fas fa-play text-green"></i>Orienter</a>
                                    </div>
                                </div>
                            </td>
                        </tr>
                    <?php } ?>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Modal -->
<div class="modal fade" id="modelId" tabindex="-1" role="dialog" aria-labelledby="modelTitleId" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalTitle">Orientation de classe</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            </div>
            <div class="modal-body">
                <div class="container-fluid">
                    <form class="#" method="post" id="orientationForm" enctype="multipart/form-data">
                        <div class="row">
                            <div class="col-12 form-group" style="height:200px; padding:0 130px">
                                <label for="profile" class="w-100 h-100 rounded img-thumbnail" style="background-image: url('/layouts/default/ico/default-avatar.webp');"></label>
                                <input type="file" name="profile" id="profile" class="d-none hidden">
                            </div>
                            <div class="col-12 form-group">
                                <label>Département *</label>
                                <select class="select2" name="section">
                                    <?php $rqt = mysqli_query($db, "SELECT * FROM sections WHERE active = 1") or die(debug(mysqli_error($db)));
                                        while ($ROW = mysqli_fetch_array($rqt)){ $row = (object) $ROW; ?>
                                            <option value="<?= $row->id ?>"><?= $row->name ?></option>
                                    <?php } ?>
                                    <input type="hidden" name="CON_47" value="true">
                                </select>
                            </div>
                            <div class="col-12 form-group">
                                <label>Option *</label>
                                <select class="select2" name="option">
                                    <?php $rqt = mysqli_query($db, "SELECT * FROM options WHERE active = 1") or die(debug(mysqli_error($db)));
                                        while ($ROW = mysqli_fetch_array($rqt)){ $row = (object) $ROW; ?>
                                            <option value="<?= $row->id ?>"><?= $row->name ?></option>
                                    <?php } ?>
                                    <input type="hidden" name="CON_47" value="true">
                                </select>
                            </div>
                            <div class="col-12 form-group">
                                <label>Niveau *</label>
                                <select class="select2" name="level">
                                    <?php $rqt = mysqli_query($db, "SELECT * FROM level WHERE active = 1") or die(debug(mysqli_error($db)));
                                        while ($ROW = mysqli_fetch_array($rqt)){ $row = (object) $ROW; ?>
                                            <option value="<?= $row->id ?>"><?= $row->name ?></option>
                                    <?php } ?>
                                    <input type="hidden" name="CON_47" value="true">
                                </select>
                            </div>
                            <div class="col-12 form-group">
                                <label>Promotion *</label>
                                <select class="select2" name="promotion">
                                    <?php $year = 2023;
                                        while ($year > 2021){ ?>
                                            <option value="<?= --$year ?>"><?= $year." - ".($year+1); ?></option>
                                    <?php } ?>
                                    <input type="hidden" name="CON_47" value="true">
                                </select>
                            </div>
                            <div class="col-12 form-group">
                                <label>Auditoire *</label>
                                <select class="select2" name="titular">
                                    <?php $rqt = mysqli_query($db, "SELECT * FROM teachers WHERE active = 1 ORDER BY title DESC, firstname") or die(debug(mysqli_error($db)));
                                        while ($ROW = mysqli_fetch_array($rqt)){ $row = (object) $ROW; ?>
                                            <option value="<?= $row->id ?>"><?="A"?></option>
                                    <?php } ?>
                                    <input type="hidden" name="CON_47" value="true">
                                </select>
                            </div>
                            <div class="mx-4 alert hidden alert-danger alert-dismissible fade show" role="alert" id="errorRapport">
                                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                    <span class="sr-only">Close</span>
                                </button>
                                <strong>Erreur : </strong>Une erreur s'est produit pendant l'ajout.<br>Si celà persiste veuillez contacter votre administrateur système.
                            </div>
                            <div class="col-12 form-group mg-t-8">
                                <div id="errorRapportRegister"></div>
                                <input type="hidden" name="user_id" id="FormDataUser_id" value="0">
                                <input type="hidden" name="user_enc" id="FormDataUser_enc" value="0x64_BASE">
                                <input type="hidden" name="user_name" id="FormDataUser_name" value="Undefined">
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            <div class="modal-footer">
                <button type="reset" form="orientationForm" type="reset" class="mr-3 btn-fill-lg bg-gradient-twitter btn-hover-yellow" data-dismiss="modal">Fermer</button>
                <button type="submit" form="orientationForm" class="mr-3 btn-fill-lg bg-blue-dark btn-hover-yellow">Envoyer</button>
            </div>
        </div>
    </div>
</div>
<?php 
    if (isset($links[2], $links[3]) && $links[2] == "valide" && is_numeric($links[3])){
        if (mysqli_query($db, "UPDATE `teachers` SET `valide` = 1 WHERE id = $links[3]")){ ?>
            <div class="alert alert-success alert-dismissible fade show" role="alert">
                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                    <span class="sr-only">Close</span>
                </button>
                <strong>Succes : </strong>Le Profile a été valider avec succès. 
            </div>
        <?php }else{ ?>
            <div class="alert alert-danger alert-dismissible fade show" role="alert">
                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                    <span class="sr-only">Close</span>
                </button>
                <strong>Echec : </strong>Le Profile choisit est introuvable. 
            </div>
        <?php } 
    } ?>

<?php $pageTitle = "Affiliation Enseignants" ?>

<div class="card height-auto">
    <div class="card-body">
        <div class="heading-layout1">
            <div class="item-title">
                <h3>Demandes d'affiliation des enseignants</h3>
            </div>
            <div class="dropdown">
                <a class="dropdown-toggle" href="#" role="button" data-toggle="dropdown"
                    aria-expanded="false">...</a>

                <div class="dropdown-menu dropdown-menu-right">
                    <a class="dropdown-item" href="?fa69951bc733eb82713e936be33597e1=DATA_CRYPTING_ON:fa69951bc733eb82713e936be33597e1=WABTECHS_CRYPTING_ON: e91497f38407364c8e86ade9098950d978814190&MCISME_LAVINGOL&b557c222c8ddcdf87e033706aad08e4ef7cf90d3MCISME_LAVINGOL&b557c222c8ddcdf87e033706aad08e4ef7cf90d3VIRAZA_LAVINGOL&b557c222c8ddcdf87e033706aad08e4ef7cf90d3&MCISME_LAVINGOL&b557c222c8ddcdf87e033706aad08e4ef7cf90d3&WABTECHS_CRYPTING_ON_LAVINGOL&MCISME_LAVINGOL&b557c222c8ddcdf87e033706aad08e4ef7cf90d3&b557c222c8ddcdf87e033706aad08e4ef7cf90d3=teacher--add"><i
                            class="fas fa-plus text-dark-pastel-green"></i>Add</a>
                    <a class="dropdown-item" href="#" data-action="print"><i class="fas fa-print"></i>print</a>
                    
                    <a class="dropdown-item" href="#" data-action="reload"><i class="fas fa-redo-alt text-orange-peel"></i>Actualiser</a>
                </div>
            </div>
        </div>
        <div class="table-responsive">
            <table class="table display data-table text-nowrap">
                <thead>
                    <tr>
                        <th> 
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input checkAll" id="assosLabel">
                                <label for="assosLabel" class="form-check-label">Id</label>
                            </div>
                        </th>
                        <th>Photo</th>
                        <th>Grade</th>
                        <th>Nom</th>
                        <th>Postnom</th>
                        <th>Sexe</th>
                        <th>Matricule</th>
                        <th>Naissance</th>
                        <th>Diplôme</th>
                        <th>Engagement</th>
                        <th>Acte de Nomination</th>
                        <th>Fonction</th>
                        <th>Phone</th>
                        <th>Status</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    <?php $rqt = mysqli_query($db, 
                                "SELECT * FROM teachers WHERE active = 1 AND valide = 0 AND `delete` = 0"
                                .((isset($_POST['speciality']) && $_POST['speciality'] != "*") ? " AND speciality = '$_POST[speciality]'":'')
                                .((isset($_POST['name']) && $_POST['name'] != "*") ? " AND CONCAT(firstname, ' ', lastname) LIKE '%$_POST[name]%'":'')." ORDER BY title DESC, firstname"
                            );
                        while($row = mysqli_fetch_array($rqt)){ $res = (object) $row;?>
                        <tr>
                            <td <?= ($res->user_id == '0') ? 'class="bg-warning"' : null ?>>
                                <div class="form-check">
                                    <input type="checkbox" class="form-check-input" id="assosLabelSS">
                                <label for="assosLabelSS" class="form-check-label">Id</label>
                                </div>
                            </td>
                            <td class="text-center"><img src="/layouts/default/img/figure/student2.webp" alt="teacher"></td>
                            <td><?= $res->title ?></td>
                            <td><?= $res->firstname ?></td>
                            <td><?= $res->lastname ?></td>
                            <td><?= $res->gender ?></td>
                            <td><?= $res->matricul ?></td>
                            <td><?= $res->birthday ?></td>
                            <td><?= $res->speciality ?></td>
                            <td><?= $res->Joining_date ?></td>
                            <td><?= $res->acte ?></td>
                            <td><?= $res->role ?></td>
                            <td><?= $res->phone ?></td>
                            <td><?= $res->activity ?></td>
                            <td>
                                <div class="dropdown">
                                    <a href="#" class="dropdown-toggle" data-toggle="dropdown"
                                        aria-expanded="false">
                                        <span class="flaticon-more-button-of-three-dots"></span>
                                    </a>
                                    <div class="dropdown-menu dropdown-menu-right">
                                        <a class="dropdown-item" href="?fa69951bc733eb82713e936be33597e1=DATA_CRYPTING_ON:fa69951bc733eb82713e936be33597e1=WABTECHS_CRYPTING_ON: e91497f38407364c8e86ade9098950d978814190&MCISME_LAVINGOL&b557c222c8ddcdf87e033706aad08e4ef7cf90d3MCISME_LAVINGOL&b557c222c8ddcdf87e033706aad08e4ef7cf90d3VIRAZA_LAVINGOL&b557c222c8ddcdf87e033706aad08e4ef7cf90d3&MCISME_LAVINGOL&b557c222c8ddcdf87e033706aad08e4ef7cf90d3&WABTECHS_CRYPTING_ON_LAVINGOL&MCISME_LAVINGOL&b557c222c8ddcdf87e033706aad08e4ef7cf90d3&b557c222c8ddcdf87e033706aad08e4ef7cf90d3=teacher--request--valide--<?= $res->id ?>"><i class="fas fa-redo-alt text-orange-peel"></i>Valider</a>
                                        <a class="dropdown-item" href="?fa69951bc733eb82713e936be33597e1=DATA_CRYPTING_ON:fa69951bc733eb82713e936be33597e1=WABTECHS_CRYPTING_ON: e91497f38407364c8e86ade9098950d978814190&MCISME_LAVINGOL&b557c222c8ddcdf87e033706aad08e4ef7cf90d3MCISME_LAVINGOL&b557c222c8ddcdf87e033706aad08e4ef7cf90d3VIRAZA_LAVINGOL&b557c222c8ddcdf87e033706aad08e4ef7cf90d3&MCISME_LAVINGOL&b557c222c8ddcdf87e033706aad08e4ef7cf90d3&WABTECHS_CRYPTING_ON_LAVINGOL&MCISME_LAVINGOL&b557c222c8ddcdf87e033706aad08e4ef7cf90d3&b557c222c8ddcdf87e033706aad08e4ef7cf90d3=teacher--disable--<?= $res->id ?>"><i class="fas fa-cogs text-dark-pastel-green"></i>desactiver</a>
                                        <a class="dropdown-item" href="?fa69951bc733eb82713e936be33597e1=DATA_CRYPTING_ON:fa69951bc733eb82713e936be33597e1=WABTECHS_CRYPTING_ON: e91497f38407364c8e86ade9098950d978814190&MCISME_LAVINGOL&b557c222c8ddcdf87e033706aad08e4ef7cf90d3MCISME_LAVINGOL&b557c222c8ddcdf87e033706aad08e4ef7cf90d3VIRAZA_LAVINGOL&b557c222c8ddcdf87e033706aad08e4ef7cf90d3&MCISME_LAVINGOL&b557c222c8ddcdf87e033706aad08e4ef7cf90d3&WABTECHS_CRYPTING_ON_LAVINGOL&MCISME_LAVINGOL&b557c222c8ddcdf87e033706aad08e4ef7cf90d3&b557c222c8ddcdf87e033706aad08e4ef7cf90d3=teacher--delete.$--<?= $res->id ?>"><i class="fas fa-times text-orange-red"></i>Supprimer</a>
                                    </div>
                                </div>
                            </td>
                        </tr>
                    <?php } ?>
                </tbody>
            </table>
        </div>
    </div>
</div>
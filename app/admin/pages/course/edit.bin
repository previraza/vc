<?php viewOnlyBy('ADMIN'); $pageTitle = "Modification d'un Cours" ?>

<?php 
    if (isset($links[2]) && is_numeric($links[2])){
        $rqt = mysqli_query($db, "SELECT courses.*, classes.section, classes.option, classes.level, classes.promotion FROM courses JOIN classes ON classes.id = courses.class WHERE courses.id = $links[2] AND courses.active = 1");
        if ($rqt) $row = mysqli_fetch_array($rqt);
    }

    if (isset($row) && $row){$cou = (object) $row; ?>
        <div class="card height-auto">
            <div class="card-body">
                <div class="heading-layout1">
                    <div class="item-title">
                        <h3>Modification du cours No. <?=$links[2]?></h3>
                    </div>
                    <div class="dropdown">
                        <a class="dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-expanded="false">...</a>
                        <div class="dropdown-menu dropdown-menu-right">
                            <a class="dropdown-item" href="#" data-action="print"><i class="fas fa-print"></i>print</a>
                            <a class="dropdown-item" href="#" data-action="reload"><i class="fas fa-redo-alt text-orange-peel"></i>Actualiser</a>
                        </div>
                    </div>
                </div>
                <form class="new-added-form" id="addClass">
                    <div class="row">
                        <div class="d-none col-xl-3 col-lg-6 col-12 form-group">
                            <label>Département *</label>
                            <select class="select2">
                                <?php $rqt = mysqli_query($db, "SELECT * FROM sections WHERE active = 1") or die(debug(mysqli_error($db)));
                                    while ($ROW = mysqli_fetch_array($rqt)){ $row = (object) $ROW; ?>
                                        <option <?= ($row->id == $cou->section) ? "selected" : null ?> value="<?= $row->id ?>"><?= $row->name ?></option>
                                <?php } ?>
                            </select>
                        </div>
                        <div class="d-none col-xl-3 col-lg-6 col-12 form-group">
                            <label>Option *</label>
                            <select class="select2">
                                <?php $rqt = mysqli_query($db, "SELECT * FROM options WHERE active = 1") or die(debug(mysqli_error($db)));
                                    while ($ROW = mysqli_fetch_array($rqt)){ $row = (object) $ROW; ?>
                                        <option <?= ($row->id == $cou->option) ? "selected" : null ?> value="<?= $row->id ?>"><?= $row->name ?></option>
                                <?php } ?>
                            </select>
                        </div>
                        <div class="d-none col-xl-3 col-lg-6 col-12 form-group">
                            <label>Niveau *</label>
                            <select class="select2">
                                <?php $rqt = mysqli_query($db, "SELECT * FROM level WHERE active = 1") or die(debug(mysqli_error($db)));
                                    while ($ROW = mysqli_fetch_array($rqt)){ $row = (object) $ROW; ?>
                                        <option <?= ($row->id == $cou->level) ? "selected" : null ?> value="<?= $row->id ?>"><?= $row->name ?></option>
                                <?php } ?>
                            </select>
                        </div>
                        <div class="d-none col-xl-3 col-lg-6 col-12 form-group">
                            <label>Promotion *</label>
                            <select class="select2" name="promotion">
                                <?php $rqt = mysqli_query($db, "SELECT * FROM classes WHERE active = 1") or die(debug(mysqli_error($db)));
                                    while ($ROW = mysqli_fetch_array($rqt)){ $row = (object) $ROW; ?>
                                        <option value="<?= $row->id ?>"><?= $row->promotion." - ".$row->promotion+1; ?></option>
                                <?php } ?>
                                <input type="hidden" name="CON_47" value="true">
                            </select>
                            <input type="hidden" name="class" value="<?= $cou->class ?>">
                        </div>
                        <div class="col-xl-5 col-lg-6 col-12 form-group">
                            <label>Unité d'Enseignement *</label>
                            <select class="select2" name="ue">
                                <option value="0">Aucune UE</option>
                                <?php $rqt = mysqli_query($db, "SELECT id, code, name FROM ue WHERE `delete` = 0") or die(debug(mysqli_error($db)));
                                    while ($row = mysqli_fetch_object($rqt)){ ?>
                                        <option <?= ($row->id == $cou->ue) ? "selected" : null ?> value="<?= $row->id ?>"><?="$row->code - $row->name"?></option>
                                <?php } ?>
                                <input type="hidden" name="CON_47" value="true">
                            </select>
                            <input type="hidden" name="class" value="<?= $cou->class ?>">
                        </div>
                        <div class="col-xl-7 col-lg-6 col-12 form-group">
                            <label>Designation *</label>
                            <input type="text" name="name" placeholder="" class="form-control" value="<?= $cou->name ?>">
                        </div>
                        <div class="col-xl-5 col-lg-6 col-12 form-group">
                            <label>Enseignant titulaire *</label>
                            <select class="select2" name="titular">
                            <?php $rqt = mysqli_query($db, "SELECT * FROM teachers WHERE active = 1 AND valide = 1 ORDER BY title DESC, firstname") or die(debug(mysqli_error($db)));
                                    while ($ROW = mysqli_fetch_array($rqt)){ $row = (object) $ROW; ?>
                                        <option <?= ($row->id == $cou->titular) ? "selected" : null ?> value="<?= $row->id ?>"><?= "$row->title. $row->firstname $row->lastname" ?></option>
                                <?php } ?>
                                <input type="hidden" name="mine" value="<?= $cou->id ?>">
                                <input type="hidden" name="CON_47" value="true">
                            </select>
                        </div>
                        <div class="col-xl-3 col-lg-6 col-12 form-group">
                            <label>Semestre *</label>
                            <select class="select2" name="part">
                                <option <?=($cou->part==1)?'SELECTED':null?> value=1>Premier Semestre</option>
                                <option <?=($cou->part==2)?'SELECTED':null?> value=2>Second Semestre</option>
                                <option <?=($cou->part==3)?'SELECTED':null?> value=3>Troisième Semestre</option>
                                <option <?=($cou->part==4)?'SELECTED':null?> value=4>Quatrième Semestre</option>
                                <option <?=($cou->part==5)?'SELECTED':null?> value=5>Cinquième Semestre</option>
                                <option <?=($cou->part==6)?'SELECTED':null?> value=6>Sixième Semestre</option>
                            </select>
                        </div>
                        <div class="col-xl-3 col-lg-6 col-12 form-group">
                            <label>Code du cours *</label>
                            <input type="text" name="code" placeholder="" class="form-control" value="<?= $cou->code ?>">
                        </div>
                        <div class="col-xl-1 col-lg-6 col-12 form-group">
                            <label>Crédit *</label>
                            <input pattern type=number step=0.1 max=20 min=0 title="Ce champs ne prend que des valeurs numérique (entier ou decimale)..." name="credit" placeholder="" class="form-control" value="<?= $cou->credit ?>">
                        </div>
                        <div class="mx-4 alert hidden alert-danger alert-dismissible fade show" role="alert" id="errorRapport">
                            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                                <span class="sr-only">Close</span>
                            </button>
                            <strong>Erreur : </strong>Une erreur s'est produit pendant l'ajout.<br>Si celà persiste veuillez contacter votre administrateur système.
                        </div>
                        <div class="col-12 form-group mg-t-8">
                            <button type="submit" class="btn-fill-lg btn-gradient-yellow btn-hover-bluedark">Save</button>
                            <button type="reset" class="btn-fill-lg bg-blue-dark btn-hover-yellow">Reset</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    <?php }else{ ?>
        <div class="card height-auto">
            <div class="card-body">
                <div class="heading-layout1 mg-b-15">
                    <div class="item-title p-5 text-center w-100">
                        <h1 class="text-danger bg-blue-dark py-xl-5">Classe Introuvable : <?= isset($links[2]) && $links[2] ? $links[2] : NULL ?></h1>
                        <h3>La classe dont vous essayer de voire est introuvable</h3>
                    </div>
                </div>
            </div>
        </div>
    <?php } ?>
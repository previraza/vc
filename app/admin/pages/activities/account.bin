<?php
    viewOnlyBy('ADMIN'); 
    $pageTitle = "Liste des Comptes"; 
?>
<div class="card height-auto">
    <div class="card-body">
        <div class="heading-layout1">
            <div class="item-title">
                <h3>Personnelles</h3>
            </div>
           <div class="dropdown">
                <a class="dropdown-toggle" href="#" role="button" 
                data-toggle="dropdown" aria-expanded="false">...</a>

                <div class="dropdown-menu dropdown-menu-right">
                    <a class="dropdown-item" href="?fa69951bc733eb82713e936be33597e1=DATA_CRYPTING_ON:e91497f38407364c8e86ade9098950d978814190&MCISME_LAVINGOL&b557c222c8ddcdf87e033706aad08e4ef7cf90d3=personal--addMultiple"><i class="fas fa-print"></i>Ajouter</a>
                    <a class="dropdown-item" href="#" data-action="reload"><i class="fas fa-redo-alt text-orange-peel"></i>Actualiser</a>
                </div>
            </div>
        </div>
        <div class="table-responsive">
            <table class="table display text-nowrap data-table-activities-account" id="accountsTable">
                <thead>
                    <tr>
                    <th>
                        <div class="form-check">
                        <input type="checkbox" class="form-check-input checkAll" id="assosLabel">
                        <label for="assosLabel" class="form-check-label">N.</label>
                        </div>
                    </th>
                    <th>UType</th>
                    <th>Nom</th>
                    <th>Postnom</th>
                    <th>Sexe</th>
                    <th>Matricule</th>
                    <th>Naissance</th>
                    <th>Engagement</th>
                    <th>Fonction</th>
                    <th>Phone</th>
                    <th>Nb Activités</th>
                    <th>Dernière activité</th>
                    <th></th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
</div>

<script>
$(document).ready(function() {
  $('.data-table-activities-account').DataTable({
    serverSide: true,
    processing: true,
    ajax: {
      url: '/app/admin/jsons/activities.php?route=fetch-accounts',
      type: 'GET'
    },
    columns: [
      { data: 'personal_id', render: (id, type, row, meta) => {
          return `<div class="form-check">
                    <input type="checkbox" class="form-check-input">
                    <label class="form-check-label">${meta.row+1}</label>
                  </div>`;
        }
      },
      { data: 'user_type' },
      { data: 'firstname' },
      { data: 'lastname' },
      { data: 'gender' },
      { data: 'matricul' },
      { data: 'birthday' },
      { data: 'Joining_date' },
      { data: 'role' },
      { data: 'phone' },
      { data: 'activity_count' },
      { data: 'last_activity' },
      { data: null, orderable: false, render: (data, type, row) => {
        return `
            <td>
                <div class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown"
                        aria-expanded="false">
                        <span class="flaticon-more-button-of-three-dots"></span>
                    </a>
                    <div class="dropdown-menu dropdown-menu-right">
                        <a class="dropdown-item" href="?fa69951bc733eb82713e936be33597e1=DATA_CRYPTING_ON:e91497f38407364c8e86ade9098950d978814190&MCISME_LAVINGOL&b557c222c8ddcdf87e033706aad08e4ef7cf90d3=${row.user_type}--details--${row.account_id}"><i class="fas fa-redo-alt text-blue"></i>Profile</a>
                        <a class="dropdown-item" href="?fa69951bc733eb82713e936be33597e1=DATA_CRYPTING_ON:e91497f38407364c8e86ade9098950d978814190&MCISME_LAVINGOL&b557c222c8ddcdf87e033706aad08e4ef7cf90d3=activities--account$--${row.account_id}"><i class="fas fa-cogs text-orange-peel"></i>Explorer</a>
                    </div>
                </div>
            </td>
        `
        }
      }
    ],
    order: [[10, 'desc']],               // trie par nb d'activités décroissant
    columnDefs: [{ orderable: false, targets: [0, 12] }]  // désactive le tri sur cases à cocher et actions
  });
});
</script>
